"use strict";(self.webpackChunkvp=self.webpackChunkvp||[]).push([[87412],{91498:(e,t,r)=>{r.r(t),r.d(t,{data:()=>o});const o={key:"v-36e467fd",path:"/advanced/more/tuya_ota_url.html",title:"Get Tuya OTA url",lang:"en-US",frontmatter:{pageClass:"content-page"},excerpt:"",headers:[{level:2,title:"Step 1: running the proxy",slug:"step-1-running-the-proxy",children:[]},{level:2,title:"Step 2: setup the Android emulator",slug:"step-2-setup-the-android-emulator",children:[]},{level:2,title:"Step 3: get the OTA url",slug:"step-3-get-the-ota-url",children:[]},{level:2,title:"Step 4: add OTA to zigbee-ota",slug:"step-4-add-ota-to-zigbee-ota",children:[]}],filePathRelative:"advanced/more/tuya_ota_url.md",git:{updatedTime:1644940737e3}}},62374:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ae});var o=r(66252),a=r(80331),l=r(15835),n=r(34329);const i=(0,o._)("h1",{id:"get-tuya-ota-url",tabindex:"-1"},[(0,o._)("a",{class:"header-anchor",href:"#get-tuya-ota-url","aria-hidden":"true"},"#"),(0,o.Uk)(" Get Tuya OTA url")],-1),u=(0,o._)("p",null,"This guide explains how to retrieve a TuYa OTA file for your device. This file can then be used to update your TuYa device via Zigbee2MQTT.",-1),d=(0,o._)("p",null,"Prerequisites:",-1),s=(0,o._)("li",null,"Docker",-1),h=(0,o._)("li",null,"TuYa bridge",-1),p={href:"https://developer.android.com/studio",target:"_blank",rel:"noopener noreferrer"},c=(0,o.Uk)("Android Studio"),g=(0,o._)("h2",{id:"step-1-running-the-proxy",tabindex:"-1"},[(0,o._)("a",{class:"header-anchor",href:"#step-1-running-the-proxy","aria-hidden":"true"},"#"),(0,o.Uk)(" Step 1: running the proxy")],-1),k=(0,o._)("p",null,[(0,o.Uk)("Execute the following command: "),(0,o._)("code",null,"docker run --rm -it -p 8080:8080 mitmproxy/mitmproxy")],-1),_=(0,o._)("h2",{id:"step-2-setup-the-android-emulator",tabindex:"-1"},[(0,o._)("a",{class:"header-anchor",href:"#step-2-setup-the-android-emulator","aria-hidden":"true"},"#"),(0,o.Uk)(" Step 2: setup the Android emulator")],-1),m=(0,o._)("p",null,"Start Android Studio and create a new empty project:",-1),f=(0,o._)("li",null,"File -> New -> New Project...",-1),b=(0,o._)("li",null,"Phone and Tablet -> Empty Activity -> Next",-1),y=(0,o._)("li",null,"Finish",-1),w=(0,o._)("li",null,[(0,o.Uk)('Click on the emulator ("Pixel_3a_..." in the case below) -> Device Manager '),(0,o._)("br"),(0,o.Uk)(),(0,o._)("img",{src:a,alt:""})],-1),v=(0,o._)("li",null,'Click on the pencil icon of the device, under "Show Advanced Settings" change the "Internal Storage" to "2000". Click "Finish".',-1),U=(0,o._)("li",null,[(0,o.Uk)("Start the emulator by clicking the play icon. "),(0,o._)("br"),(0,o.Uk)(),(0,o._)("img",{src:l,alt:""})],-1),T=(0,o._)("li",null,"On the emulator, go to Settings -> Network & internet -> Internet -> AndroidWifi -> Edit (pencil right top) -> Advanced options -> Proxy -> Manual. For proxy host name fill in the IP address of your computer (e.g. 192.168.2.145), for port fill in 8080. Save.",-1),x=(0,o._)("li",null,'Open Chrome on the emulator, go to http://mitm.it and click on "Get mitmproxy-ca-cert.cer" under Android.',-1),A=(0,o._)("li",null,"Go to settings again, Security -> Encryption & credentials -> Install a certificate -> CA certificate -> Install anyway -> Drawer icon -> Downloads -> click on the downloaded certificate.",-1),S=(0,o.Uk)("Download the TuYa app apk from "),O={href:"https://aapks.com/download.php?dl=48267761",target:"_blank",rel:"noopener noreferrer"},C=(0,o.Uk)("this link"),z=(0,o.Uk)(" (IMPORTANT: newer version don't work, tested with 3.12.6). Drag the downloaded apk on the emulator (which will install it)."),P=(0,o._)("h2",{id:"step-3-get-the-ota-url",tabindex:"-1"},[(0,o._)("a",{class:"header-anchor",href:"#step-3-get-the-ota-url","aria-hidden":"true"},"#"),(0,o.Uk)(" Step 3: get the OTA url")],-1),W=(0,o._)("li",null,"Open the TuYa Smart Life app in the emulator, log in with your account",-1),D=(0,o.Uk)("Make sure the TuYa bridge + the device you want to get the OTA of is already coupled to your account, this cannot be done from the emulator so use your phone for this. Make sure to use the same app on your phone, otherwise the device will not show up (e.g. for iOS use "),I={href:"https://apps.apple.com/nl/app/smart-life-smart-living/id1115101477",target:"_blank",rel:"noopener noreferrer"},Y=(0,o.Uk)("this"),F=(0,o.Uk)(", "),M={href:"https://apps.apple.com/nl/app/tuya-smart/id1034649547",target:"_blank",rel:"noopener noreferrer"},E=(0,o._)("strong",null,"not this",-1),N=(0,o.Uk)(")."),q=(0,o._)("li",null,'Click on the device -> edit (pencil icon right top). Click "Check for Firmware Upgrade".',-1),G=(0,o._)("li",null,[(0,o.Uk)("If an firmware upgarde is available, quickly go back to the output of mitm (step 1), click on the latest request (yes you can click in the console window). This will show your the OTA url (see red box below). "),(0,o._)("ul",null,[(0,o._)("li",null,[(0,o.Uk)("Tip: to go back to the overview of requests press the "),(0,o._)("code",null,"Q"),(0,o.Uk)(" key on your keyboard.")])])],-1),j=(0,o._)("p",null,[(0,o._)("img",{src:n,alt:""})],-1),L=(0,o._)("h2",{id:"step-4-add-ota-to-zigbee-ota",tabindex:"-1"},[(0,o._)("a",{class:"header-anchor",href:"#step-4-add-ota-to-zigbee-ota","aria-hidden":"true"},"#"),(0,o.Uk)(" Step 4: add OTA to zigbee-ota")],-1),Z=(0,o.Uk)("Follow "),Q={href:"https://github.com/koenkk/zigbee-ota#adding-new-and-updating-existing-ota-files",target:"_blank",rel:"noopener noreferrer"},R=(0,o.Uk)("this guide"),H=(0,o.Uk)(" to add the OTA to the "),K={href:"https://github.com/koenkk/zigbee-ota",target:"_blank",rel:"noopener noreferrer"},B=(0,o.Uk)("zigbee-OTA"),J=(0,o.Uk)(" repository."),V=(0,o.Uk)("Enable the ota by adding "),X=(0,o._)("code",null,"ota: ota.zigbeeOTA",-1),$=(0,o.Uk)(" to your device definition ("),ee={href:"https://github.com/Koenkk/zigbee-herdsman-converters/blob/3e45f8f13b419ea8ce33fb3d30b11f5ac1bdec08/devices/tuya.js#L1172",target:"_blank",rel:"noopener noreferrer"},te=(0,o.Uk)("example"),re=(0,o.Uk)(")."),oe={},ae=(0,r(83744).Z)(oe,[["render",function(e,t){const r=(0,o.up)("OutboundLink");return(0,o.wg)(),(0,o.iD)(o.HY,null,[i,u,d,(0,o._)("ul",null,[s,h,(0,o._)("li",null,[(0,o._)("a",p,[c,(0,o.Wm)(r)])])]),g,k,_,m,(0,o._)("ol",null,[f,b,y,w,v,U,T,x,A,(0,o._)("li",null,[S,(0,o._)("a",O,[C,(0,o.Wm)(r)]),z])]),P,(0,o._)("ol",null,[W,(0,o._)("li",null,[D,(0,o._)("a",I,[Y,(0,o.Wm)(r)]),F,(0,o._)("a",M,[E,(0,o.Wm)(r)]),N]),q,G]),j,L,(0,o._)("ol",null,[(0,o._)("li",null,[Z,(0,o._)("a",Q,[R,(0,o.Wm)(r)]),H,(0,o._)("a",K,[B,(0,o.Wm)(r)]),J]),(0,o._)("li",null,[V,X,$,(0,o._)("a",ee,[te,(0,o.Wm)(r)]),re])])],64)}]])},83744:(e,t)=>{t.Z=(e,t)=>{for(const[r,o]of t)e[r]=o;return e}},15835:(e,t,r)=>{e.exports=r.p+"assets/img/android_studio_adv.eb66c947.png"},80331:(e,t,r)=>{e.exports=r.p+"assets/img/android_studio_run.429dab07.png"},34329:(e,t,r)=>{e.exports=r.p+"assets/img/tuya_ota.c9bc92f7.png"}}]);